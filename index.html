<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>D3</title>
</head>
<body>
    

    <script>
        var pieData = [
                {
                    id: 1, parent_id: 0, name: "Health & Fitness", icon: "img/health-fitness.svg", amount: 79
                }, 
                {
                    id: 2, parent_id: 0, name: "Kids", icon: "img/kids.svg", amount: 55
                },
                {
                    id: 3, parent_id: 0, name: "Food & Drinks", icon: "img/food.svg", amount: 17
                },
            ];

    var subcat = [  { id: 4, parent__id: 1, name: "pharmacy", icon:"icon-link", amount: 68},
                    { id: 5, parent__id: 1, name: "medicine", icon:"icon-link", amount: 89},
                    { id: 6, parent__id: 1, name: "health-insurance", icon:"icon-link", amount: 11},
                    { id: 7, parent__id: 1, name: "sports", icon:"icon-link", amount: 290},
                    { id: 8, parent__id: 2, name: "babysitter-daycare", amount: 1},
                    { id: 9, parent__id: 2, name: "kids-activities", icon:"icon-link", amount: 1},
                    { id: 10, parent__id: 2, name: "child-support", icon:"icon-link", amount: 1},
                    { id: 11, parent__id: 2, name: "toys", icon:"icon-link", amount: 2},
                    { name: "restaurants", icon:"icon-link", amount: 68},
                             { name: "coffee-shop", icon:"icon-link", amount: 89},
                             { name: "groceries", icon:"icon-link", amount: 11},
                             { name: "alcohol-bars", icon:"icon-link", amount: 850}
                ]


var width = 540,
    height = 360,
    outerRadius = 113,
    innerRadius = 66.5,
    labelR = outerRadius + 20;        

var color = d3.scaleOrdinal(["#3f51b5", "#009688", "#039be5", "#d2d588",
                            "#795548", "#ff6f00", "#e91e63", "#607d8b",
                            "#7cb342", "#e53935"]);


var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var g = svg.append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

var pie = d3.pie().value(function (d) {
    return d.amount;
});

var pieArc = d3.arc()
    .outerRadius(outerRadius)
    .innerRadius(innerRadius);


var arcs = g.selectAll(".arc")
    .data(pie(pieData))
    .enter().append("g")
    .attr("class", "arc");

//add color to slices

var slices = arcs.append("path")
    .attr("d", pieArc)
    .attr("fill", function (d, i) { return color(i); })
    .attr("stroke", "#fff");

//add icons

var slicesWithIcons = arcs.filter(function(d,i) {
    var angle = d.endAngle - d.startAngle;

    if(angle > 0.38) {    //??find corret number for angle when slice is big enough for icon
        return true;
    }
    return false;
    });

slicesWithIcons.append("svg:image")
    .attr("href", function(d) {return d.data.icon})   
    .attr("transform", function(d){
        var x = pieArc.centroid(d)[0] - 9;
        var y = pieArc.centroid(d)[1] - 9;
        return "translate(" + x + "," + y + ")";
    })
    .attr("width", 16).attr("height", 16); //??calculate correct height


// change opacity of slice on mouseover, change cursor to zoom-in 
slices.on("mouseover", function() {
        d3.select(this).style("opacity", .5)
                       .style("cursor", "zoom-in");
    }).
    on("mouseout", function() {
        d3.select(this).style("opacity", 1)
                       .style("cursor", "pointer");
    });

// add labels

var labels = arcs.append("text")
    .attr("transform", function(d) {
        var c = pieArc.centroid(d),
            x = c[0],
            y = c[1],
            // pythagorean theorem for hypotenuse
            h = Math.sqrt(x*x + y*y);
        return "translate(" + (x/h * labelR) +  ',' +
           (y/h * labelR) +  ")"; 
    })
    .attr("dy", ".35em")
    .attr("text-anchor", function(d) {
        // are we past the center?
        return (d.endAngle + d.startAngle)/2 > Math.PI ?
            "end" : "start";
    })
    .text(function(d, i) { return d.data.name; });

    </script>
</body>
</html>